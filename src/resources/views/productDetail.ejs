<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= product.productName %></title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/styles.css" />
    <!-- Gán file CSS riêng nếu cần -->
    <style>
      body {
        font-family: "Roboto", sans-serif;
        margin: 0;
        padding: 0;
        background-color: #fff;
        color: #333;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      .breadcrumb {
        font-size: 14px;
        color: #666;
        margin-bottom: 20px;
      }
      .breadcrumb a {
        color: #666;
        text-decoration: none;
      }
      .breadcrumb a:hover {
        text-decoration: underline;
      }
      .product {
        display: flex;
        flex-wrap: wrap;
      }
      .product img {
        max-width: 100%;
        height: auto;
        max-height: 500px;
      }
      .product-details {
        flex: 1;
        padding: 20px;
      }
      .product-title {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 10px;
      }
      .product-rating {
        font-size: 14px;
        color: #666;
        margin-bottom: 10px;
      }
      .product-rating i {
        color: #f5c518;
      }
      .product-price {
        font-size: 24px;
        font-weight: 700;
        color: #333;
        margin-top: 20px;
        margin-bottom: 20px;
      }
      .product-description {
        font-size: 14px;
        color: #666;
        margin-bottom: 20px;
        margin-top: 20px;
      }
      .product-actions {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 20px;
        margin-top: 50px;
      }
      .product-actions button {
        padding: 10px;
        font-size: 14px;
        border: none;
        cursor: pointer;
      }
      .product-info {
        display: flex;
        flex-direction: column;
        gap: 10px;
        font-size: 14px;
        color: #666;
        margin-top: 50px;
      }
      .product-info i {
        margin-right: 10px;
      }
      .tabs {
        display: flex;
        margin-top: 20px;
        border-bottom: 1px solid #ccc;
      }
      .tab {
        padding: 10px 20px;
        cursor: pointer;
        font-size: 14px;
        color: #333;
      }
      .tab.active {
        border-bottom: 2px solid #007bff;
        color: #007bff;
      }
      .tab-content {
        padding: 20px 0;
        font-size: 14px;
        color: #666;
      }
      @media (max-width: 768px) {
        .product {
          flex-direction: column;
        }
        .product-details {
          padding: 10px;
        }
      }

      /* From Uiverse.io by elijahgummer */
      .chat-btn ul {
        position: relative;
        display: flex;
        gap: 25px;
      }

      .chat-btn ul li {
        position: relative;
        list-style: none;
        width: 60px;
        height: 60px;
        background: #d4a373;
        border-radius: 60px;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        transition: 0.5s;
      }

      .chat-btn ul li:hover {
        width: 250px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0);
      }

      .chat-btn ul li::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 60px;
        background: linear-gradient(45deg, var(--i), var(--j));
        opacity: 0;
        transition: 0.5s;
      }

      .chat-btn ul li:hover::before {
        opacity: 1;
      }

      .chat-btn ul li::after {
        content: "";
        position: absolute;
        top: 10px;
        width: 100%;
        height: 100%;
        border-radius: 60px;
        background: linear-gradient(45deg, var(--i), var(--j));
        transition: 0.5s;
        filter: blur(15px);
        z-index: -1;
        opacity: 0;
      }

      .chat-btn ul li:hover::after {
        opacity: 0.5;
      }

      .chat-btn ul li .icon {
        color: #777;
        font-size: 1.75em;
        transition: 0.5s;
        transition-delay: 0.25s;
      }

      .chat-btn ul li:hover .icon {
        transform: scale(0);
        color: #fff;
        transition-delay: 0s;
      }

      .chat-btn ul li span {
        position: absolute;
      }

      .chat-btn ul li .title {
        color: #fff;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        transform: scale(0);
        transition: 0.5s;
        transition-delay: 0s;
      }

      .chat-btn ul li:hover .title {
        transform: scale(1);
        transition-delay: 0.25s;
      }

      /* btn */
      /* From Uiverse.io by doniaskima */
      .btn-53,
      .btn-53 *,
      .btn-53 :after,
      .btn-53 :before,
      .btn-53:after,
      .btn-53:before {
        border: 0 solid;
        box-sizing: border-box;
      }

      .btn-53 {
        -webkit-tap-highlight-color: transparent;
        -webkit-appearance: button;
        background-color: #000;
        background-image: none;
        color: #fff;
        cursor: pointer;
        font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont,
          Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif,
          Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
        font-size: 100%;
        line-height: 1.5;
        margin: 0;
        -webkit-mask-image: -webkit-radial-gradient(#000, #fff);
        padding: 0;
      }

      .btn-53:disabled {
        cursor: default;
      }

      .btn-53:-moz-focusring {
        outline: auto;
      }

      .btn-53 svg {
        display: block;
        vertical-align: middle;
      }

      .btn-53 [hidden] {
        display: none;
      }

      .btn-53 {
        width: 100%;
        border: 1px solid;
        border-radius: 0;
        box-sizing: border-box;
        display: block;
        font-weight: 500;
        overflow: hidden;
        padding: 1.2rem 3rem;
        position: relative;
        text-transform: uppercase;
      }

      .btn-53 .original {
        background: #8a8989;
        color: #000;
        display: grid;
        inset: 0;
        place-content: center;
        position: absolute;
        transition: transform 0.2s cubic-bezier(0.87, 0, 0.13, 1);
      }

      .btn-53:hover .original {
        transform: translateY(100%);
      }

      .btn-53 .letters {
        display: inline-flex;
      }

      .btn-53 span {
        margin-right: 5px;
        opacity: 0;
        transform: translateY(-15px);
        transition: transform 0.2s cubic-bezier(0.87, 0, 0.13, 1), opacity 0.2s;
      }

      .btn-53 span:nth-child(2n) {
        transform: translateY(15px);
      }

      .btn-53:hover span {
        opacity: 1;
        transform: translateY(0);
      }

      .btn-53:hover span:nth-child(2) {
        transition-delay: 0.1s;
      }

      .btn-53:hover span:nth-child(3) {
        transition-delay: 0.2s;
      }

      .btn-53:hover span:nth-child(4) {
        transition-delay: 0.3s;
      }

      .btn-53:hover span:nth-child(5) {
        transition-delay: 0.4s;
      }

      .btn-53:hover span:nth-child(6) {
        transition-delay: 0.5s;
      }
    </style>
  </head>
  <body>
    <!-- Include Header -->
    <%- include('partials/header') %>

    <div class="container">
      <div class="breadcrumb">
        <a href="/">Trang chủ</a> / <a href=""><%= product.productName %></a>
      </div>
      <div class="product">
        <div class="product-image">
          <!-- Bootstrap Carousel -->
          <div
            id="productCarousel"
            class="carousel slide"
            data-ride="carousel"
            style="height: 400px; width: 600px"
          >
            <div class="carousel-inner">
              <% product.image.forEach((img, index) => { %>
              <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                <img
                  src="<%= img.url %>"
                  class="d-block"
                  alt="<%= product.productName %>"
                  width="600"
                  height="400"
                />
              </div>
              <% }) %>
            </div>
            <a
              class="carousel-control-prev"
              href="#productCarousel"
              role="button"
              data-slide="prev"
            >
              <span
                class="carousel-control-prev-icon"
                aria-hidden="true"
              ></span>
              <span class="sr-only">Previous</span>
            </a>
            <a
              class="carousel-control-next"
              href="#productCarousel"
              role="button"
              data-slide="next"
            >
              <span
                class="carousel-control-next-icon"
                aria-hidden="true"
              ></span>
              <span class="sr-only">Next</span>
            </a>
          </div>
        </div>
        <div class="product-details">
          <div class="product-title"><%= product.productName %></div>
          <div class="product-rating">
            <% const fullStars = Math.floor(averageRating);
            const hasHalfStar = (averageRating % 1) !== 0; 
          %> <% for (let i = 1; i <= 5; i++) { %> <% if (i <= fullStars)
            { %>
            <!-- Hiển thị sao vàng -->
            <i class="fas fa-star text-yellow-500"></i>
            <% } else if (i === fullStars + 1 && hasHalfStar) { %>
            <!-- Hiển thị nửa sao -->
            <i class="fas fa-star-half-alt text-yellow-500"></i>
            <% } else { %>
            <!-- Hiển thị sao xám -->
            <i class="far fa-star text-gray-300"></i>
            <% } %> <% } %>

            <!-- Hiển thị giá trị trung bình số sao -->
            <span class="ml-2 text-gray-600"
              >(<%= averageRating.toFixed(1) %> sao)</span
            >
            <span
              ><a
                href="/user/view/<%= product.sellerId._id %>"
                style="text-decoration: none"
                >| <%= product.sellerId.name %></a
              ></span
            >
          </div>
          <div class="product-price"><%= product.price %> VND</div>
          <div class="product-description"><%= product.description %></div>

          <div class="product-info">
            <div><i class="fas fa-truck"></i> Miễn phí vận chuyển</div>
            <div>
              <i class="fas fa-clock"></i> Dự kiến giao hàng: Thường được gửi đi
              trong vòng 24 giờ
            </div>
            <div>
              <i class="fas fa-shield-alt"></i> Chính sách bảo mật: Đảm bảo an
              toàn cho hệ thống, tổ chức hoặc thực thể khác
            </div>
          </div>

          <div class="product-actions">
            <form action="/cart/addToCart" method="Post">
              <input type="hidden" value="<%= product._id%>" name="id" />
              <button class="btn-53">
                <div class="original">Thêm vào giỏ hàng</div>
                <div class="letters">
                  <span> Thêm </span>
                  <span> vào </span>
                  <span> giỏ </span>
                  <span> hàng </span>
                </div>
              </button>
            </form>
            <form action="/checkout" method="POST">
              <!-- Gửi danh sách ID của sản phẩm, ở đây chỉ có một sản phẩm nên không cần map -->
              <input
                type="hidden"
                name="productIds"
                value="<%= JSON.stringify([product._id]) %>"
              />
              <button class="btn-53">
                <div class="original">Mua ngay</div>
                <div class="letters">
                  <span> Mua </span>
                  <span> ngay </span>
                </div>
              </button>
            </form>
          </div>

          <div>
            <!-- From Uiverse.io by doniaskima -->
          </div>

          <div class="chat-btn">
            <ul>
              <li style="--i: #cc9159; --j: #2f80ed">
                <a
                  href="/chat/start/<%= product.sellerId._id %>"
                  style="
                    text-decoration: none;
                    color: inherit;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    width: 100%;
                    height: 100%;
                  "
                >
                  <span class="icon">💬</span>
                  <span class="title">Chat với người bán</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Include Footer -->
    <%- include('partials/footer') %>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
      function startChat(sellerId) {
        window.location.href = `/chat/start/${sellerId}`;
      }
    </script>
  </body>
</html>
