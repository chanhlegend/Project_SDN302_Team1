<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/friend.css">
</head>
<body>
    <div class="friends-container">
        <h2 class="text-center">B·∫°n B√®</h2>
        <div class="tab-header">
            <div id="followersTab" class="tab active">ƒê∆Ø·ª¢C THEO D√ïI (<%= followers.length %>)</div>
            <div id="followingTab" class="tab">ƒêANG THEO D√ïI (<%= following.length %>)</div>
        </div>
        <button class="add-friend-btn mt-3">‚ûï TH√äM B·∫†N B√à</button>

        <!-- Danh s√°ch ng∆∞·ªùi theo d√µi -->
        <div id="followersContent" class="friend-list active">
            <% if (followers.length === 0) { %>
                <p class="text-center">Kh√¥ng c√≥ ng∆∞·ªùi theo d√µi n√†o.</p>
            <% } else { %>
                <% followers.forEach(follower => { %>
                    <div class="friend-item" id="follower-<%= follower.followerId._id %>">
                        <img src="<%= follower.followerId.avatar || '/img/avatar.png' %>" alt="User">
                        <span><%= follower.followerId.username %></span>
                        <!-- <span class="ms-auto">
                            <button class="btn btn-outline-warning btn-sm" onclick="unfollow('<%= follower.followerId._id %>')">‚úîÔ∏èüë§</button>
                        </span> -->
                    </div>
                <% }) %>
            <% } %>
        </div>

        <!-- Danh s√°ch ng∆∞·ªùi ƒëang theo d√µi -->
        <div id="followingContent" class="friend-list">
            <% if (following.length === 0) { %>
                <p class="text-center">B·∫°n ch∆∞a theo d√µi ai.</p>
            <% } else { %>
                <% following.forEach(follow => { %>
                    <div class="friend-item" id="following-<%= follow.followingId._id %>">
                        <img src="<%= follow.followingId.avatar || '/img/avatar.png' %>" alt="User">
                        <span><%= follow.followingId.username %></span>
                        <span class="ms-auto">
                            <button class="btn btn-outline-danger btn-sm" onclick="removeFollowing('<%= follow.followingId._id %>')">‚ùå H·ªßy theo d√µi</button>
                        </span>
                    </div>
                <% }) %>
            <% } %>
        </div>
    </div>

    <!-- N√∫t ti·∫øp t·ª•c mua s·∫Øm -->
    <div class="continue-shopping text-center mt-3">
        <a href="/" class="btn btn-dark">CONTINUE SHOPPING</a>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const followersTab = document.getElementById("followersTab");
            const followingTab = document.getElementById("followingTab");
            const followersContent = document.getElementById("followersContent");
            const followingContent = document.getElementById("followingContent");

            // M·∫∑c ƒë·ªãnh hi·ªÉn th·ªã danh s√°ch followers
            followersContent.style.display = "block";
            followingContent.style.display = "none";

            // X·ª≠ l√Ω khi click v√†o tab "ƒê∆∞·ª£c theo d√µi"
            followersTab.addEventListener("click", function () {
                followersTab.classList.add("active");
                followingTab.classList.remove("active");

                followersContent.style.display = "block";
                followingContent.style.display = "none";
            });

            // X·ª≠ l√Ω khi click v√†o tab "ƒêang theo d√µi"
            followingTab.addEventListener("click", function () {
                followingTab.classList.add("active");
                followersTab.classList.remove("active");

                followingContent.style.display = "block";
                followersContent.style.display = "none";
            });
        });

        function unfollow(followerId) {
            fetch(`/follow/unfollower`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ followerId }) 
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("H·ªßy follow th√†nh c√¥ng!");
                    document.getElementById(`follower-${followerId}`).remove(); 
                } else {
                    alert(data.message || "C√≥ l·ªói x·∫£y ra khi h·ªßy follow!");
                }
            })
            .catch(error => {
                console.error("L·ªói:", error);
            });
        }

        function removeFollowing(followingId) {
            fetch(`/follow/unfollower`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ followingId }) 
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("H·ªßy theo d√µi th√†nh c√¥ng!");
                    document.getElementById(`following-${followingId}`).remove();
                } else {
                    alert(data.message || "C√≥ l·ªói x·∫£y ra khi h·ªßy theo d√µi!");
                }
            })
            .catch(error => {
                console.error("L·ªói:", error);
            });
        }
    </script>
</body>
</html>
