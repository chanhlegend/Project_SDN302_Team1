<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your personal information</title>
    <link rel="stylesheet" href="/css/profile.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>
<body>
    <div class="container">
        <div class="left-section">
            <div class="header">
                <div class="logo">
                    <img src="/img/avatar.png" alt="Logo">
                    <span class="badge">Ho·∫°t ƒë·ªông 2 gi·ªù tr∆∞·ªõc</span>
                </div>
            </div>
            <div class="actions">
                <button>Chia s·∫ª</button>
                <button id="followBtn">Theo d√µi</button>
            </div>
            <div class="title">Toyota ƒê√¥ng S√†i G√≤n | CN G√≤ V·∫•p</div>
            <div class="rating">
                <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                <span>4.8</span>
                <span>(6 nh·∫≠n x√©t)</span>
                <span>ƒê√£ x√°c th·ª±c</span>
            </div>
            <div class="address">üìç ƒê·ªãa ch·ªâ: @@@@@@@@@@@@@@@@</div>
            <div class="stats">
                <div>ƒê√£ b√°n <br> 25</div>
                <div>Ng∆∞·ªùi theo d√µi <br> 21</div>
                <div>Xe ƒëang b√°n <br> 18</div>
            </div>
            <div class="contact">
                <span>üìû 0909******</span>
                <span>B·∫•m ƒë·ªÉ hi·ªán s·ªë</span>
            </div>
        </div>
        
        
        <div class="right-section">
            <form action="/user/update-profile/<%= user._id %>" method="POST">
                <div class="form-group">
                    <label>First name</label>
                    <input type="text" name="first_name" value="<%= user.first_name %>" disabled>
                </div>
                <div class="form-group">
                    <label>Last name</label>
                    <input type="text" name="last_name" value="<%= user.last_name %>" disabled>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" value="<%= user.email %>" disabled>
                </div>
                <div class="form-group">
                    <label>Birthdate</label>
                    <input type="text" id="birthdate" name="birthdate" value="<%= user.dob ? user.dob.toLocaleDateString('en-US') : '' %>" disabled>      
                </div>
                <div class="form-actions">
                    <div class="left-buttons">
                        <a href="/" class="back-button">
                            <span class="arrow">‚Üê</span> BACK TO YOUR ACCOUNT
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
</body>
<script>
document.getElementById("followBtn").addEventListener("click", async function () {
    try {
        const pathArray = window.location.pathname.split("/");
        const followingId = pathArray[pathArray.length - 1]; 

        if (!followingId) {
            alert("Kh√¥ng t√¨m th·∫•y ID ng∆∞·ªùi theo d√µi");
            return;
        }

        const response = await fetch("/follow/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ followingId }),
        });

        if (response.ok) {
            this.textContent = "ƒê√£ theo d√µi";
            this.disabled = true; 
        } else {
            alert("C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i.");
        }
    } catch (error) {
        console.error("L·ªói:", error);
    }
});


document.addEventListener("DOMContentLoaded", async function () {
    try {
        const pathArray = window.location.pathname.split("/");
        const followingId = pathArray[pathArray.length - 1];

        if (!followingId) return;

        const response = await fetch(`/follow/check-follow/${followingId}`);
        const data = await response.json();

        if (data.isFollowing) {
            const followBtn = document.getElementById("followBtn");
            followBtn.textContent = "ƒê√£ theo d√µi";
            followBtn.disabled = true;
            followBtn.classList.add("following");
        }
    } catch (error) {
        console.error("L·ªói:", error);
    }
});
</script>
</html>
